"use strict";function checkPrefix(e,t){var r=e.match(PREFIX_REGEX),n=!1;if(null!==r)for(var o=r[1].split(""),i=0;i<o.length;i++)if(o[i]===t){n=!0;break}return n}function isExportable(e){return!checkPrefix(e.name,EXPORT_FLAG)}function isExported(e){return checkPrefix(e.name,EXPORT_FLAG)}function isSkipped(e){return isLayerGroup(e.type)&&checkPrefix(e.name,SKIP_FLAG)}function isSkippable(e){return isLayerGroup(e.type)&&!checkPrefix(e.name,SKIP_FLAG)}function isLayerGroup(e){return"layerSection"===e}function isArtboard(e){return e.hasOwnProperty("artboard")&&("artboardSection"===e.type||isLayerGroup(e.type))}function getZeplinTempDir(){return getTempDir()+BUNDLE_ID+"/"}function getTempDir(){var e=os.tmpdir();return"/"!==e.slice(-1)&&(e+="/"),e}function checkPathCreateIfNotExists(e){var t=path.dirname(e),r=(new Date).getTime();try{fs.lstatSync(t)}catch(n){mkdirp.sync(t)}console.log("path created in",(new Date).getTime()-r,"ms")}function saveFileToDisk(e,t){checkPathCreateIfNotExists(e);var r=(new Date).getTime(),n=fs.createWriteStream(e);n.once("open",function(){n.write(t),n.end(),console.log("file saved in",(new Date).getTime()-r,"ms")})}function stripPrefix(e){var t=e.match(PREFIX_REGEX);return null!==t?t[2]:e}function getLayerType(e){return isArtboard(e)?"artboard":isLayerGroup(e.type)?"layerSection":"layer"}function inspectExecution(e,t,r){console.log("stdout: "+t),console.log("stderr: "+r),null!==e&&console.log("exec error: "+e)}function openZeplin(e){switch(e&&(e=path.resolve(e)),getOsType()){case"mac":e?exec("open -b "+BUNDLE_ID+" "+e,inspectExecution):exec("open -b "+BUNDLE_ID,inspectExecution);break;case"win":fs.existsSync(path.resolve(process.env.LOCALAPPDATA+"\\Zeplin\\Update.exe"))?e?exec('"%LOCALAPPDATA%\\Zeplin\\Update.exe" --processStart=Zeplin.exe -a "--export \\"'+e+'\\""',inspectExecution):exec('"%LOCALAPPDATA%\\Zeplin\\Update.exe" --processStart=Zeplin.exe',inspectExecution):(console.log("process not found under LOCALAPPDATA, falling back to PROGRAMDATA.."),e?exec('"%PROGRAMDATA%\\%USERNAME%\\Zeplin\\Update.exe" --processStart=Zeplin.exe -a "--export \\"'+e+'\\""',inspectExecution):exec('"%PROGRAMDATA%\\%USERNAME%\\Zeplin\\Update.exe" --processStart=Zeplin.exe',inspectExecution));break;default:console.log("unknown platform")}}function findProxy(){var e,t=Q.defer();switch(getOsType()){case"mac":e="echo $HTTP_PROXY";break;case"win":e="echo %HTTP_PROXY%";break;default:t.reject("invalid os type..")}return exec(e,function(e,r){if(e)console.log("HTTP_PROXY could not be fetched..",e),t.resolve();else{var n=r.trim();"win"==getOsType()&&"%HTTP_PROXY%"==n?t.resolve():t.resolve(n)}}),t.promise}function setPhotoshopVersion(e){psVersion=e}function getPhotoshopVersion(){return psVersion}function setPluginVersion(e){pluginVersion=e}function getPluginVersion(){return pluginVersion}function setAppPath(e){switch(getOsType()){case"mac":appPath=e;break;case"win":var t=e.split("/").filter(function(e){return e});t[0]=t[0]+":\\",appPath=path.resolve.apply(null,t)}console.log("appPath is defined:",appPath)}function getAppPath(){return appPath}function getGeneratorPluginPath(){return path.resolve(appPath+GENERATOR_PATH)}function getPanelPath(){switch(getOsType()){case"mac":return homedir()+"/Library/Application Support/Adobe/CEP/extensions/"+PANEL_FOLDER;case"win":return process.env.APPDATA?path.resolve(process.env.APPDATA,"Adobe","CEP","extensions",PANEL_FOLDER):path.resolve(homedir(),"AppData","Roaming","Adobe","CEP","extensions",PANEL_FOLDER);default:console.log("unknown platform")}}function getOsType(){return"darwin"===os.platform()?"mac":"win32"===os.platform()?"win":void console.log("invalid os type:",os.platform())}function calculatePadding(e,t){return{top:e.top-t.top,left:e.left-t.left,bottom:t.bottom-e.bottom,right:t.right-e.right}}function getToken(){var e,t=Q.defer();switch(getOsType()){case"mac":e=path.resolve(homedir()+"/Library/Application Support/"+BUNDLE_ID+"/zt");break;case"win":e=process.env.APPDATA?path.resolve(process.env.APPDATA,"Zeplin","zt"):path.resolve(homedir(),"AppData","Roaming","Zeplin","zt");break;default:return console.log("unknown platform"),void t.reject("unknown platform")}return fs.readFile(e,{encoding:"utf8"},function(e,r){return e?void t.reject(e):void t.resolve(r.trim())}),t.promise}function assetFactors(e,t){switch(e){case"android":switch(t){case"mdpi":return{png:["1000","1500","2000","3000","4000"],svg:["1000"]};case"hdpi":return{png:["1000","0666","1333","2000","2666"],svg:["1000"]};case"xhdpi":return{png:["1000","0500","0750","1500","2000"],svg:["1000"]};case"xxhdpi":return{png:["1000","0333","0500","0666","1333"],svg:["1000"]};case"xxxhdpi":return{png:["1000","0250","0375","0500","0750"],svg:["1000"]};default:console.log("unknown density",t)}break;case"ios":switch(t){case"1x":return{png:["1000","2000","3000"],pdf:["1000"]};case"2x":return{png:["1000","0500","1500"],pdf:["0500"]};case"3x":return{png:["1000","0333","0666"],pdf:["0333"]};default:console.log("unknown density",t)}break;case"web":switch(t){case"1x":return{png:["1000","2000","3000"],svg:["1000"]};case"2x":return{png:["1000","0500","1500"],svg:["1000"]};case"3x":return{png:["1000","0333","0666"],svg:["1000"]};default:console.log("unknown density",t)}break;case"osx":switch(t){case"1x":return{png:["1000","2000"],pdf:["1000"]};case"2x":return{png:["1000","0500"],pdf:["0500"]};default:console.log("unknown density",t)}break;default:console.log("unknown type",e)}}function predictArtboardDensity(e,t){return{ios:predictForIos(e),android:predictForAndroid(e,t),web:predictForWeb(e)}}function predictForIos(e){for(var t in densityTable.ios)if(densityTable.ios.hasOwnProperty(t)&&densityTable.ios[t].indexOf(e)!==-1)return t}function predictForAndroid(e,t){for(var r in densityTable.android)if(densityTable.android.hasOwnProperty(r))for(var n=0;n<densityTable.android[r].length;n++){var o=densityTable.android[r][n];if(o.height&&o.height===t&&o.width===e)return r;if(o.width===e)return r}}function predictForWeb(e){for(var t in densityTable.web)if(densityTable.web.hasOwnProperty(t)&&densityTable.web[t].indexOf(e)!==-1)return t}function parseProxy(){var e=process.env.HTTP_PROXY;if(process.env.PROXY_USER&&process.env.PROXY_PASS){var t=process.env.PROXY_USER+":"+process.env.PROXY_PASS+"@",r=/(https:\/\/)|(http:\/\/)/i,n=e.match(r);if(n){var o=n[0];e=e.substring(0,n.index+o.length)+t+e.substring(n.index+o.length,e.length)}else e="http://"+t+e}return e}function maskProxy(e){return process.env.PROXY_PASS?e.replace(process.env.PROXY_PASS,"*".repeat(process.env.PROXY_PASS.length)):e}var path=require("path"),fs=require("fs"),os=require("os"),exec=require("child_process").exec,homedir=require("homedir"),mkdirp=require("mkdirp"),Q=require("q"),densityTable=require("./static/density_table"),EXPORT_FLAG="e",SKIP_FLAG="g",API_URL="https://api.zeplin.io",PREFIX_REGEX="^-([a-z]+)-(.*)$",BUNDLE_ID="io.zeplin.osx",GENERATOR_PATH="/Plug-ins/Generator/",PANEL_FOLDER="io.zeplin.photoshop-panel",modelVersion=2,appPath,psVersion,pluginVersion;module.exports={API_URL:API_URL,EXPORT_FLAG:EXPORT_FLAG,SKIP_FLAG:SKIP_FLAG,V:modelVersion,stripPrefix:stripPrefix,isSkipped:isSkipped,isSkippable:isSkippable,isExported:isExported,isExportable:isExportable,isLayerGroup:isLayerGroup,isArtboard:isArtboard,getLayerType:getLayerType,checkPathCreateIfNotExists:checkPathCreateIfNotExists,saveFileToDisk:saveFileToDisk,getZeplinTempDir:getZeplinTempDir,getGeneratorPluginPath:getGeneratorPluginPath,getPanelPath:getPanelPath,setAppPath:setAppPath,getAppPath:getAppPath,inspectExecution:inspectExecution,openZeplin:openZeplin,getPhotoshopVersion:getPhotoshopVersion,setPhotoshopVersion:setPhotoshopVersion,getPluginVersion:getPluginVersion,setPluginVersion:setPluginVersion,calculatePadding:calculatePadding,getToken:getToken,assetFactors:assetFactors,getOsType:getOsType,findProxy:findProxy,parseProxy:parseProxy,maskProxy:maskProxy,predictArtboardDensity:predictArtboardDensity};