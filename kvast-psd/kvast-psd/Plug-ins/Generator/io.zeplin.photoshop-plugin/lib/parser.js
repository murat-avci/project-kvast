"use strict";function analyzeLayer(e,t,r,o){_layerInProgress=utils.stripPrefix(t.name),_logger.log(t.id+", "+t.name+", "+t.type);var a=e.resolution,n=determineBounds(t,o),i=calculateSize(n,r);if(!isNaN(i.height)&&i.height<=0||!isNaN(i.width)&&i.width<=0)return void _logger.log("skipping layer, outside bounds:",i);var l=determineBoundsWithEffects(t,o),s=intersectBounds(l,r),c=checkIfCropped(l,s),u=parseLayerOpacity(t.blendOptions),d=parseEffects(t);if(t.hasOwnProperty("fill"))if("solidColorLayer"===t.fill["class"]){var f=parseColorFillEffect(t.fill),g=d.fills.some(function(e){return 1==e.opacity});g||d.fills.unshift(f)}else if("gradientLayer"===t.fill["class"]){var p=parseGradientEffect(t.fill);p&&d.fills.unshift(p)}var h=t.hasOwnProperty("blendOptions")?parseBlendMode(t.blendOptions):void 0,y=t.hasOwnProperty("text")?parseTextStyle(t,u,a):{},v=t.hasOwnProperty("path")?parseBorderRadius(t):void 0,m=utils.stripPrefix(t.name);return 0==m.length&&(m="Untitled"),{name:m,originalName:t.name,sourceId:t.id+"",blendMode:h,opacity:u,type:determineLayerType(t.type),fontFace:y.fontFace,fontSize:y.fontSize,textAlign:y.align,color:y.color,content:y.content,letterSpacing:y.letterSpacing,lineHeight:y.lineHeight,textStyles:y.styles,rect:i,fills:d.fills,borders:d.borders,borderRadius:v,shadows:d.shadows,exportable:utils.isExported(t),cropped:c,bounds:l}}function determineBounds(e,t){var r=_generator.getDeepBounds(e);if(r=integerBounds(r),t)for(var o=0;o<t.length;o++)if(t[o].ids.indexOf(e.id)>-1){r=intersectBounds(r,t[o].bounds);break}return r}function determineBoundsWithEffects(e,t){var r=e.boundsWithFX||e.bounds;if(r=integerBounds(r),t)for(var o=0;o<t.length;o++)if(t[o].ids.indexOf(e.id)>-1){r=intersectBounds(r,t[o].bounds);break}return r}function integerBounds(e){return{top:Math.floor(e.top),left:Math.floor(e.left),bottom:Math.ceil(e.bottom),right:Math.ceil(e.right)}}function intersectBounds(e,t){return{top:Math.max(e.top,t.top),left:Math.max(e.left,t.left),bottom:Math.min(e.bottom,t.bottom),right:Math.min(e.right,t.right)}}function checkIfCropped(e,t){return e.bottom-e.top!=t.height||e.right-e.left!=t.width}function toBounds(e){return{top:e.y,left:e.x,bottom:e.y+e.height,right:e.x+e.width}}function parseLayerOpacity(e){var t=1;return e&&(t=opacitySafe(e)),t}function parseBorderRadius(e){if(e.path.hasOwnProperty("pathComponents"))for(var t=0;t<e.path.pathComponents.length;t++)if(e.path.pathComponents[t].hasOwnProperty("origin")&&"roundedRect"===e.path.pathComponents[t].origin.type&&e.path.pathComponents[t].origin.hasOwnProperty("radii")){var r=e.path.pathComponents[t].origin.radii;return checkIfAllSame(r)}}function checkIfAllSame(e){if(0!==e.length){for(var t=0;t<e.length;t++)if(e[t]!==e[0])return;return e[0]}}function pixelValue(e,t){if(!(e instanceof Object))return e;switch(e.units){case"pointsUnit":return Math.round(ptToPx(e.value,t));default:return e.value}}function ptToPx(e,t){return e*t/72}function normalizeTextStyleValue(e,t){return 1===t?e:Math.round(e*t*2)/2}function parseFontStyle(e,t,r,o){var a=[];return e.forEach(function(e){var n,i=e.textStyle,l=normalizeTextStyleValue(pixelValue(i.size,r),o);n=i.fontPostScriptName?i.fontPostScriptName:i.fontName+" "+i.fontStyleName;var s={r:0,g:0,b:0,a:t};i.hasOwnProperty("color")&&(s=toRGB(i.color,t));var c;i.hasOwnProperty("tracking")&&(c=l*i.tracking/1e3);var u;i.hasOwnProperty("leading")&&(u=normalizeTextStyleValue(pixelValue(i.leading,r),o)),a.push({range:{from:e.from,to:e.to},style:{fontSize:l,fontFace:n,color:s,letterSpacing:c,lineHeight:u}})}),a}function parseParagraphStyle(e,t,r){for(var o=0;o<e.length;o++){for(var a,n,i=0;i<t.length;i++)if(a||e[o].range.from>=t[i].from&&(a=i),!n&&e[o].range.to<=t[i].to){n=i;break}if(a!=n)for(var l=e[o].range.to,i=a;i<=n;i++)if(i==a)e[o].range.to=t[i].to,e[o].range.location=e[o].range.from,e[o].range.length=r.substring(e[o].range.from,e[o].range.to).trim().length,e[o].style.textAlign=parseTextAlign(t[i].paragraphStyle.align);else{var s=JSON.parse(JSON.stringify(e[o]));s.range.from=t[i].from,i==n?s.range.to=l:s.range.to=t[i].to,s.range.location=s.range.from,s.range.length=r.substring(s.range.from,s.range.to).trim().length,s.style.textAlign=parseTextAlign(t[i].paragraphStyle.align),e.splice(o+1,0,s),o++}else e[o].range.location=e[o].range.from,e[o].range.length=r.substring(e[o].range.from,e[o].range.to).trim().length,e[o].style.textAlign=parseTextAlign(t[a].paragraphStyle.align)}}function filterDuplicateTextStyles(e){var t=[];if(e&&e.length>0){t.push(e[0]);for(var r=1;r<e.length;r++)e[r].from==e[r-1].from&&e[r].to==e[r-1].to?_logger.log("detected duplicate text style.. skipping.."):t.push(e[r])}return t}function parseTextStyle(e,t,r){var o=1;e.text.hasOwnProperty("transform")&&(o=e.text.transform.yy);var a=e.text.textKey,n=filterDuplicateTextStyles(e.text.textStyleRange),i=parseFontStyle(n,t,r,o);parseParagraphStyle(i,e.text.paragraphStyleRange,a);var l,s=e.text.paragraphStyleRange[0].paragraphStyle;s.hasOwnProperty("align")&&(l=parseTextAlign(s.align));var c=i[0].style;return mergeIdenticalStyles(i,a),filterInvalidStyles(i),_logger.log("finalStyles:",i),{align:l,content:a,fontFace:c.fontFace,fontSize:c.fontSize,color:c.color,lineHeight:c.lineHeight,letterSpacing:c.letterSpacing,styles:i}}function filterInvalidStyles(e){for(var t=0;t<e.length;t++)e[t].range.length<1&&(e.splice(t,1),t--)}function mergeIdenticalStyles(e,t){for(var r=0;r<e.length-1;r++)isIdenticalStyle(e[r],e[r+1])&&(e[r].range.to=e[r+1].range.to,e[r].range.length=t.substring(e[r].range.from,e[r].range.to).trim().length,e.splice(r+1,1),r--)}function isIdenticalStyle(e,t){return e.style.fontSize==t.style.fontSize&&e.style.fontFace==t.style.fontFace&&e.style.lineHeight==t.style.lineHeight&&e.style.textAlign==t.style.textAlign&&e.style.letterSpacing==t.style.letterSpacing&&isIdenticalColor(e.style.color,t.style.color)}function isIdenticalColor(e,t){return e&&t&&e.a==t.a&&e.r==t.r&&e.g==t.g&&e.b==t.b}function parseTextAlign(e){return e&&e.indexOf("justify")!==-1?"justify":e}function parseEffects(e){var t=[],r=[],o=[];if(e.hasOwnProperty("layerEffects")){var a=e.layerEffects;if(a.hasOwnProperty("dropShadow")&&(_logger.log("has dropShadow"),a.dropShadow.enabled)){var n=parseShadowEffect(a.dropShadow,"outer");r.push(n)}if(a.hasOwnProperty("dropShadowMulti")&&(_logger.log("has dropShadowMulti"),a.dropShadowMulti.forEach(function(e){if(e.enabled){var t=parseShadowEffect(e,"outer");r.push(t)}})),a.hasOwnProperty("innerShadow")&&(_logger.log("has innerShadow"),a.innerShadow.enabled)){var n=parseShadowEffect(a.innerShadow,"inner");r.push(n)}if(a.hasOwnProperty("innerShadowMulti")&&(_logger.log("has innerShadowMulti"),a.innerShadowMulti.forEach(function(e){if(e.enabled){var t=parseShadowEffect(e,"inner");r.push(t)}})),a.hasOwnProperty("outerGlow")&&_logger.log("has outerGlow"),a.hasOwnProperty("bevelEmboss")&&_logger.log("has bevelEmboss"),a.hasOwnProperty("chromeFX")&&_logger.log("has chromeFX"),a.hasOwnProperty("solidFill")&&(_logger.log("has solidFill"),a.solidFill.enabled)){var i=parseColorFillEffect(a.solidFill);t.unshift(i)}if(a.hasOwnProperty("solidFillMulti")&&(_logger.log("has solidFillMulti"),a.solidFillMulti.forEach(function(e){if(e.enabled){var r=parseColorFillEffect(e);t.unshift(r)}})),a.hasOwnProperty("patternFill")&&_logger.log("has patternFill"),a.hasOwnProperty("gradientFill")&&(_logger.log("has gradientFill"),a.gradientFill.enabled)){var i=parseGradientEffect(a.gradientFill);i&&t.unshift(i)}if(a.hasOwnProperty("gradientFillMulti")&&(_logger.log("has gradientFillMulti"),a.gradientFillMulti.forEach(function(e){if(e.enabled){var r=parseGradientEffect(e);r&&t.unshift(r)}})),a.hasOwnProperty("frameFX")&&(_logger.log("has frameFX"),a.frameFX.enabled)){var l=parseBorderEffect(a.frameFX);l&&o.push(l)}a.hasOwnProperty("frameFXMulti")&&(_logger.log("has frameFXMulti"),a.frameFXMulti.forEach(function(e){if(e.enabled){var t=parseBorderEffect(e);t&&o.push(t)}}))}if(e.hasOwnProperty("strokeStyle")&&(_logger.log("has strokeStyle"),1==e.strokeStyle.strokeEnabled)){var l=parseStrokeEffect(e.strokeStyle);l&&o.push(l)}return{fills:t,borders:o,shadows:r}}function parseBlendMode(e){if(e.hasOwnProperty("mode")){var t=e.mode;switch(t){case"darken":return"darken";case"multiply":return"multiply";case"colorBurn":return"color-burn";case"lighten":return"lighten";case"screen":return"screen";case"colorDodge":return"color-dodge";case"overlay":return"overlay";case"softLight":return"soft-light";case"hardLight":return"hard-light";case"difference":return"difference";case"exclusion":return"exclusion";case"hue":return"hue";case"saturation":return"saturation";case"color":return"color";case"luminosity":return"luminosity";default:return"normal"}}}function parseColorFillEffect(e){var t={},r=opacitySafe(e);return t.color=toRGB(e.color,r),t.opacity=r,t.fillType="color",t.blendMode=parseBlendMode(e),t}function parseGradientEffect(e){var t=parseGradientObject(e);if(t)return{gradient:t,opacity:opacitySafe(e),fillType:"gradient",blendMode:parseBlendMode(e)}}function parseStrokeEffect(e){var t={};if(t.opacity=opacitySafe(e.strokeStyleOpacity),e.strokeStyleLineWidth.hasOwnProperty("value")?t.thickness=e.strokeStyleLineWidth.value:t.thickness=e.strokeStyleLineWidth,t.position=parseStrokePosition(e.strokeStyleLineAlignment),e.strokeStyleContent.hasOwnProperty("color"))t.fillType="color",t.color=toRGB(e.strokeStyleContent.color,t.opacity);else{if(!e.strokeStyleContent.hasOwnProperty("gradient"))return;t.fillType="gradient",t.gradient=parseGradientObject(e.strokeStyleContent)}return t.blendMode=parseBlendMode(e.strokeStyleBlendMode),t}function parseStrokePosition(e){switch(e){case"strokeStyleAlignInside":return"inside";case"strokeStyleAlignCenter":return"center";case"strokeStyleAlignOutside":return"outside";default:_logger.log("unknown stroke style alignment: ",e)}}function parseBorderEffect(e){var t={};if(t.opacity=opacitySafe(e),t.thickness=e.size,t.position=parseBorderPosition(e.style),t.fillType=parseBorderFillType(e.paintType),"color"===t.fillType)t.color=toRGB(e.color,t.opacity);else{if("gradient"!==t.fillType)return;var r=parseGradientObject(e);if(!r)return;t.gradient=r}return t.blendMode=parseBlendMode(e),t}function parseShadowEffect(e,t){var r={},o=opacitySafe(e);r.color=toRGB(e.color,o),r.opacity=o,r.spread=e.blur*e.chokeMatte/100,r.blurRadius=e.blur-r.spread;var a=calculateShadowOffset(e);return r.offsetX=a.x,r.offsetY=a.y,r.type=t,r.blendMode=parseBlendMode(e),r}function calculateShadowOffset(e){var t;return t=e.useGlobalAngle===!0?_globalLight.angle:e.localLightingAngle.value,{x:Math.cos(toRadian(t))*e.distance,y:Math.sin(toRadian(t))*e.distance}}function toRadian(e){return(180-e)*Math.PI/180}function parseGradientObject(e){var t=1;e.hasOwnProperty("scale")&&(t=e.scale.value);var r=parseGradientType(e.type);if(r){var o=0;return e.hasOwnProperty("angle")&&(o=e.angle.value),e.hasOwnProperty("reverse")&&e.reverse===!0&&(o+=180),{to:{x:0,y:0},from:{x:0,y:0},angle:o,scale:t,type:r,colorStops:calculateColorStops(e.gradient)}}}function parseGradientType(e){switch(e){case"linear":return"linear";case"angle":return"angular";case"radial":return"radial";default:_logger.log("unknown gradient type: ",e)}}function parseBorderFillType(e){switch(e){case"solidColor":return"color";case"gradientFill":return"gradient";default:_logger.log("unknown paint type: ",e)}}function parseBorderPosition(e){switch(e){case"insetFrame":return"inside";case"outsetFrame":return"outside";case"centeredFrame":return"center";default:_logger.log("unknown border style: ",e)}}function calculateColorStops(e){var t=[],r=4096,o=e.colors,a=e.transparency;return o.forEach(function(e){var o=calculateAlpha(e.location,a);t.push({color:toRGB(e.color,o),position:e.location/r})}),t}function calculateAlpha(e,t){var r,o=findTransparencyRange(e,t);if(2===o.length){var a=o[1].location-o[0].location,n=o[1].opacity.value-o[0].opacity.value,i=0!==a?n/a:0,l=e-o[0].location;r=(o[0].opacity.value+i*l)/100}return void 0==r&&(r=1),r}function findTransparencyRange(e,t){for(var r=[],o=0;o<t.length;o++){if(t[o].location===e){r[0]=t[o],r[1]=t[o];break}if(t[o].location>e){0===o?r[0]=t[o]:r[0]=t[o-1],r[1]=t[o];break}}return r}function opacitySafe(e){var t=1;return e.hasOwnProperty("opacity")&&(t=e.opacity.value/100),t}function determineLayerType(e){return"textLayer"===e?"text":"shape"}function calculateSize(e,t){var r=intersectBounds(e,t),o=toSize(r);return intersectRect(o,toSize(t))}function toSize(e){return{x:e.left,y:e.top,height:e.bottom-e.top,width:e.right-e.left}}function intersectRect(e,t){return{x:Math.max(0,e.x-t.x),y:Math.max(0,e.y-t.y),height:Math.min(e.height,t.height),width:Math.min(e.width,t.width)}}function checkIfLine(e){if(e&&e.path&&e.path.pathComponents)return e.path.pathComponents.reduce(function(e,t){return e&&t.origin&&"line"===t.origin.type},!0)}function extractLayers(e,t,r,o){var a=[],n=[];if(t.layers){var i=t;t.layers.forEach(function(t,l){if(t.visible){if(t.path&&t.path.bounds&&!checkIfLine(t)&&(t.bounds=t.path.bounds),t.clipped)for(var s=l+1;s<i.layers.length;s++)if(!i.layers[s].clipped){t.bounds=intersectBounds(t.bounds,i.layers[s].bounds),t.hasOwnProperty("boundsWithFX")&&(t.boundsWithFX=intersectBounds(t.boundsWithFX,i.layers[s].bounds));break}if(utils.isLayerGroup(t.type)){var c=findMaskBounds(t);if(utils.isSkipped(t)){var u=analyzeLayer(e,t,r,c);if(u){if(u.exportable){var d={id:u.sourceId,name:u.originalName,pixels:hasBitmapLayer(t.layers,e)};u.cropped&&(d.bounds=u.bounds),n.push(d)}delete u.bounds,delete u.cropped,a.push(u)}}else{var f=extractLayers(e,t,r,c);if(a=a.concat(f.parsedLayers),n=n.concat(f.assets),utils.isExported(t)){var u=analyzeLayer(e,t,r,c);if(u){if(u.exportable){var d={id:u.sourceId,name:u.originalName,pixels:hasBitmapLayer(t.layers,e)};u.cropped&&(d.bounds=u.bounds),n.push(d)}delete u.bounds,delete u.cropped,a.push(u)}}}}else if(!utils.isExported(t)&&t.hasOwnProperty("smartObject")){_logger.log("has smartObject");var g=findSmartObject(e,t.smartObject.ID);if(g){var p=JSON.parse(JSON.stringify(g));fixSmartObjectBounds(t.smartObject.transform,p,t.bounds);var c=findMaskBounds(p),f=extractLayers(p,p,r,c);a=a.concat(f.parsedLayers)}var u=analyzeLayer(e,t,r,o);if(u){if(u.exportable){var d={id:u.sourceId,name:u.originalName,pixels:t.pixels||hasBitmapLayer(g.layers,e)};u.cropped&&(d.bounds=u.bounds),n.push(d)}delete u.bounds,delete u.cropped,a.push(u)}}else{var h;if(t.hasOwnProperty("smartObject")){var g=findSmartObject(e,t.smartObject.ID);g&&(h=g.fileType)}var u=analyzeLayer(e,t,r,o);if(u){if(u.exportable){var d={id:u.sourceId,name:u.originalName,smartObjectFileType:h,pixels:t.pixels};u.cropped&&(d.bounds=u.bounds),n.push(d)}delete u.bounds,delete u.cropped,a.push(u)}}}})}return{parsedLayers:a,assets:n}}function hasBitmapLayer(e,t){if(e)for(var r=0;r<e.length;r++){if(1==e[r].pixels)return!0;if(e[r].layers&&hasBitmapLayer(e[r].layers,t))return!0;if(e[r].hasOwnProperty("smartObject")){var o=findSmartObject(t,e[r].smartObject.ID);if(o&&hasBitmapLayer(o.layers,t))return!0}}return!1}function findSmartObject(e,t){if(t&&e.placed)for(var r=0;r<e.placed.length;r++)if(e.placed[r].placedID===t)return e.placed[r]}function fixSmartObjectBounds(e,t,r){var o={top:e[1],left:e[0],bottom:e[7],right:e[2]};_logger.log("layerBounds:",o);var a=t.bounds;_logger.log("smartObjectBounds:",a);var n={h:(o.bottom-o.top)/(a.bottom-a.top),w:(o.right-o.left)/(a.right-a.left)};if(_logger.log("ratio:",n),isFinite(n.h)&&isFinite(n.w)){var i=o.top,l=o.left;t.hasOwnProperty("layers")&&t.layers.forEach(function(e){fixSmartLayerBounds(l,i,e,n,r)})}}function fixSmartLayerBounds(e,t,r,o,a){var n;n=r.hasOwnProperty("path")?r.path.bounds:r.bounds;var i=Math.round(t+n.top*o.h),l=Math.round(e+n.left*o.w),s=n.bottom-n.top,c=n.right-n.left,u={top:i,left:l,bottom:Math.round(i+s*o.h),right:Math.round(l+c*o.w)};a&&(u=intersectBounds(u,a)),r.bounds=u,r.hasOwnProperty("path")&&(r.path.bounds=u),r.hasOwnProperty("layers")&&r.layers.forEach(function(r){fixSmartLayerBounds(e,t,r,o,a)})}function findMaskBounds(e){var t=[],r=[];if(e.layers)for(var o=0;o<e.layers.length;o++)e.layers[o].clipped===!0?r.push(e.layers[o].id):r.length>0&&(t.push({ids:clone([],r),bounds:e.layers[o].bounds}),r=[]);var a=t.length,n=t.reduce(function(e,t){return e+t.ids.length},0);return e.layers&&n+a===e.layers.length&&t.forEach(function(t){t.ids.push(e.id)}),t}function sortByArea(e,t){var r=t.rect.height*t.rect.width-e.rect.height*e.rect.width;return 0==r?e.exportable&&!t.exportable?1:!e.exportable&&t.exportable?-1:r:r}function sortByPosition(e,t){return e.coordinate-t.coordinate}function parseVerticalGrid(e){if(_logger.log("vertical.length:",e.length),e.length>1){var t,r,o=Math.floor(e.length/2);e=e.sort(sortByPosition);for(var a=0;a<e.length-1;a++){var n=e[a+1].coordinate-e[a].coordinate;if(0===n)e.splice(a,1),a--;else if(a%2===0)if(r){if(!isInGridRange(r,n))return void _logger.log("invalid column width.. columnWidth:",r," value:",n)}else r=n;else if(t){if(!isInGridRange(t,n))return void _logger.log("invalid column gutter.. gutter:",t," value:",n)}else t=n}if(t&&r&&o)return{gutter:t,columnWidth:r,columnCount:o}}}function isInGridRange(e,t){var r=e+GRID_DELTA,o=e-GRID_DELTA;return o<=t&&t<=r}function parseHorizontalGrid(e){if(_logger.log("horizontal.length:",e.length),e.length>1){var t,r,o=Math.floor(e.length/2);e=e.sort(sortByPosition);for(var a=0;a<e.length-1;a++){var n=e[a+1].coordinate-e[a].coordinate;if(0===n)e.splice(a,1),a--;else if(a%2===0)if(r){if(!isInGridRange(r,n))return void _logger.log("invalid row height.. rowHeight:",r," value:",n)}else r=n;else if(t){if(!isInGridRange(t,n))return void _logger.log("invalid row gutter.. gutter:",t," value:",n)}else t=n}if(t&&r&&o)return{gutter:t,rowHeight:r,rowCount:o}}}function parseGrid(e,t){var r={vertical:[],horizontal:[]};e&&e.forEach?e.forEach(function(e){e.direction.indexOf("VERTICAL")!==-1&&t.left<=e.coordinate&&t.right>=e.coordinate?r.vertical.push(e):t.top<=e.coordinate&&t.bottom>=e.coordinate&&r.horizontal.push(e)}):_logger.log("error with guides:",e);var o=calculateMargins(t,r),a=parseHorizontalGrid(r.horizontal),n=parseVerticalGrid(r.vertical);return{horizontal:a,vertical:n,margins:o}}function calculateMargins(e,t){var r=0,o=0,a=0,n=0;return t.horizontal.length>0&&(r=t.horizontal[0].coordinate-e.top,o=e.bottom-t.horizontal[t.horizontal.length-1].coordinate),t.vertical.length>0&&(a=t.vertical[0].coordinate-e.left,n=e.right-t.vertical[t.vertical.length-1].coordinate),{top:r,left:a,bottom:o,right:n}}function convertToZeplinGrid(e){if(e&&(e.horizontal||e.vertical)){var t,r;return e.vertical&&(t={columnWidth:e.vertical.columnWidth,numberOfCols:e.vertical.columnCount,gutterWidth:e.vertical.gutter,guttersOnOutside:!1}),e.horizontal&&(r={rowHeight:e.horizontal.rowHeight,gutterHeight:e.horizontal.gutter}),{horizontalOffset:e.margins.left,vertical:t,horizontal:r}}}function toRGB(e,t){return{r:Math.round(e.red||0),g:Math.round(e.green||0),b:Math.round(e.blue||0),a:t||1}}function parseArtboardBackgroundColor(e){if(e){var t=e.split(",").map(function(e){return Number(e)});if(t&&4==t.length)return toRGB({red:t[0],green:t[1],blue:t[2]},t[3])}}var utils=require("./utils"),clone=require("object-assign"),_globalLight,_layerInProgress,_generator,_logger,GRID_DELTA=.5,Parser=function(e,t){_generator=e,_logger=t};Parser.prototype.parseArtBoard=function(e,t){_globalLight=e.globalLight;var r=parseGrid(e.guides,t.bounds);_logger.log("grid:",r);var o=toSize(t.bounds),a=parseArtboardBackgroundColor(t.backgroundColor);_logger.log("artboardBgColor:",a);var n=extractLayers(e,t,t.bounds);return _globalLight=void 0,_layerInProgress=void 0,{name:t.name,sourceId:t.id+"",height:o.height,width:o.width,rect:o,backgroundColor:a,layers:n.parsedLayers.sort(sortByArea),assets:n.assets,grid:convertToZeplinGrid(r),psLayer:t}},Parser.prototype.getLayerInProgress=function(){return _layerInProgress},Parser.prototype.calculateArtboardDimensions=function(e){var t=toSize(e.bounds);return{height:t.height,width:t.width}},module.exports=Parser;