!function(){"use strict";function e(e,r,t){v=e,x=r,y=t,y.log("initializing Zeplin photoshop generator plugin with config %j",x),v.getPhotoshopVersion().then(function(e){y.log("Photoshop Version:",e),u.setPhotoshopVersion(e),y.log("Zeplin Plugin Version:",c),u.setPluginVersion(c);var n=require(u.getPanelPath()+"/package.json").version;y.log("Zeplin Panel Version:",n)}).then(function(){return n()}).then(function(){return u.findProxy()}).then(function(e){if(e)y.log("proxy found in environment variables:",e),l.defaults({proxy:e});else{y.log("no proxy settings found in environment variables.."),y.log("checking plugin.env file..");require("dotenv").config({path:u.getGeneratorPluginPath()+"/"+h+"/plugin.env"});if(process.env.HTTP_PROXY){var n=u.parseProxy();y.log("proxy found in plugin.env:",u.maskProxy(n)),l.defaults({proxy:n})}else y.log("no proxy settings found in plugin.env..")}}).then(function(){f=new s(e,y),P=new a(y),d=new g(f,P,y),v.onPhotoshopEvent("currentDocumentChanged",i),v.onPhotoshopEvent("imageChanged",o)})["catch"](function(e){y.log("failed to initialize Zeplin Photoshop Plugin",e)})}function n(){return r("getPaths.jsx").then(function(e){e=e.replace(/%20/g," "),u.setAppPath(e)},function(e){y.log(e)})}function o(e){if(f&&!f.exportInProgress()&&(y.log("image changed.."),e.id))if(e.selection)f.triggerPanelUpdate(P,e.id);else if(e.layers)for(var n=0;n<e.layers.length;n++)if(e.layers[n].name){f.triggerPanelUpdate(P,e.id);break}}function i(e){y.log("document changed:",e),f&&!f.exportInProgress()&&(d.setCurrentDocumentId(e),f.triggerPanelUpdate(P,e))}function r(e,n){var o=t.resolve(__dirname+"/lib/jsx",e);return v.evaluateJSXFile(o,n)}var t=require("path"),l=require("request"),u=require("./lib/utils"),a=require("./lib/socket"),s=require("./lib/zeplin"),g=require("./lib/panelController"),p=require("./package.json"),h=p.name,c=p.version,f=null,P=null,d=null,v=null,x=null,y=null;exports.init=e}();